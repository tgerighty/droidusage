# Droid Forge Configuration
# This file defines the behavior and rules for the Manager Droid Orchestrator

# CRITICAL CONSTRAINT: Task System Usage
# ALL droids MUST use ONLY the ai-dev-tasks task system
# NEVER create or use built-in/native task management systems
# SINGLE SOURCE OF TRUTH: /tasks/tasks-[prd-file-name].md files
# FOLLOW EXCLUSIVELY: ai-dev-tasks process-task-list.md guidelines

factory:
  name: "Droid Forge"
  version: "0.1.0"
  description: "Manager Droid for advanced task management and droid coordination"

# Orchestrator configuration
orchestrator:
  name: "Manager Droid"
  series: "Manager and Automation System"
  description: "Manager Droid (Manager and Automation System) - Central coordinator for task management and droid orchestration"
  personality: "analytical, efficient, methodical"

  # Task state machine configuration
  task_states:
    - PENDING
    - ANALYZING
    - DELEGATED
    - EXECUTING
    - AWAITING_REVIEW
    - COMPLETED
    - FAILED

# Droid discovery and execution
droids:
  # Directories where droids are stored (searched in order)
  locations:
    - ".factory/droids"          # Project-specific droids
    - "~/.factory/droids"        # Personal/global droids

  # Default execution timeout in seconds
  default_timeout: 300

  # Security settings
  security:
    # Require explicit permissions in droid manifests
    require_permissions: true

    # Default permissions if not specified
    default_permissions:
      filesystem: ["read:."]
      git: []
      network: false

# Rule-based task delegation rules
delegation_rules:
  # Pattern matching for task types to droid capabilities
  rules:
    - pattern: "plan-review|plan-validation|pre-implementation|go-no-go|implementation-plan|architecture-review"
      capabilities: ["plan-review", "pre-implementation", "validation", "architecture-alignment"]
      droid_types: ["plan-review-droid-forge"]
      priority: 1

    - pattern: "impact-analysis|bug-impact|affected-files|file-mapping|bug-propagation|root-cause-files"
      capabilities: ["impact-analysis", "file-mapping", "bug-tracking", "propagation-analysis"]
      droid_types: ["impact-analyzer-droid-forge"]
      priority: 2

    - pattern: "refactor|cleanup|code-smell|technical-debt|improve-code|maintainability"
      capabilities: ["code-refactoring", "code-analysis", "performance-audit"]
      droid_types: ["code-refactoring-droid-forge", "fix-issue", "code-review"]
      priority: 3
    
    - pattern: "nextjs|next.js|app-router|server-components|server-actions"
      capabilities: ["nextjs", "react", "frontend-framework", "server-rendering"]
      droid_types: ["nextjs15-specialist-droid-forge"]
      priority: 1

    - pattern: "trpc|tanstack-query|react-query|type-safe-api"
      capabilities: ["trpc", "api", "type-safe-api", "data-fetching", "caching"]
      droid_types: ["trpc-tanstack-integration-droid-forge"]
      priority: 1

    - pattern: "drizzle|orm|database-schema|migrations"
      capabilities: ["drizzle", "orm", "database", "postgresql", "schema"]
      droid_types: ["drizzle-orm-specialist-droid-forge"]
      priority: 1

    - pattern: "typescript|type-safe|generics|strict-mode|type-coverage"
      capabilities: ["typescript", "type-safety", "advanced-types", "full-stack-types"]
      droid_types: ["typescript-integration-droid-forge"]
      priority: 1

    - pattern: "better-auth|authentication|auth|oauth|security"
      capabilities: ["authentication", "security", "better-auth", "nextjs-auth"]
      droid_types: ["better-auth-integration-droid-forge"]
      priority: 1

    - pattern: "valkey|redis|caching|cache-strategy"
      capabilities: ["caching", "valkey", "redis", "performance-optimization"]
      droid_types: ["valkey-caching-strategist-droid-forge"]
      priority: 1

    - pattern: "database-performance|postgresql|postgres18|query-optimization"
      capabilities: ["database-performance", "postgresql", "query-tuning", "optimization"]
      droid_types: ["database-performance-droid-forge"]
      priority: 1

    - pattern: "typescript|type-safe|generics|strict-mode|type-coverage"
      capabilities: ["typescript", "type-safety", "advanced-types"]
      droid_types: ["typescript-professional-droid-forge"]
      priority: 2

    - pattern: "test|spec|coverage|testing"
      capabilities: ["testing", "quality-assurance", "setup-comprehensive-testing"]
      droid_types: ["setup-comprehensive-testing", "write-unit-tests"]
      priority: 2

    - pattern: "security|audit|vulnerability|penetration"
      capabilities: ["security-audit", "security-review"]
      droid_types: ["security-audit", "security-review"]
      priority: 3

    - pattern: "docker|deploy|ci/cd|devops|infrastructure"
      capabilities: ["devops", "deployment", "docker-expert"]
      droid_types: ["docker-expert", "setup-monitoring-observability"]
      priority: 4

    - pattern: "database|migration|sql|db"
      capabilities: ["database-migration", "optimize-database-performance"]
      droid_types: ["database-migration", "optimize-database-performance"]
      priority: 5

    - pattern: "documentation|readme|docs|guide"
      capabilities: ["documentation", "code-review", "create-docs"]
      droid_types: ["create-docs", "add-documentation"]
      priority: 6

    - pattern: "git|version control|branch|merge|commit"
      capabilities: ["git-workflow", "version-control"]
      droid_types: ["fix-git-issues"]
      priority: 7

    - pattern: "debug|fix|error|issue|bug"
      capabilities: ["debugging", "error-handling", "fix-issue"]
      droid_types: ["debug-error", "debug-issue", "fix-issue"]
      priority: 8

    - pattern: "setup|install|configure|bootstrap"
      capabilities: ["setup", "configuration", "onboarding"]
      droid_types: ["setup-new-feature", "onboard-new-developer"]
      priority: 9

    - pattern: "performance|optimize|speed|latency"
      capabilities: ["performance-optimization", "caching", "monitoring", "assessment"]
      droid_types: ["nextjs15-assessment-droid-forge", "trpc-assessment-droid-forge", "drizzle-assessment-droid-forge", "typescript-integration-assessment-droid-forge", "auth-assessment-droid-forge", "caching-assessment-droid-forge", "database-performance-assessment-droid-forge", "implement-caching-strategy", "optimize-database-performance", "performance-audit"]
      priority: 10

    - pattern: "dependency|package.*audit"
      capabilities: ["security", "audit"]
      droid_types: ["dependency-audit"]
      priority: 11

    - pattern: "generate.*code|create.*component|scaffold.*project"
      capabilities: ["code-generation", "frontend-development", "backend-development"]
      droid_types: ["frontend-engineer-droid-forge", "backend-engineer-droid-forge", "senior-software-engineer-droid-forge"]
      priority: 11

    - pattern: "ui.*design|ux.*design|interface.*design"
      capabilities: ["ui-design", "ux-design", "interface-design"]
      droid_types: ["ui-ux-designer-droid-forge"]
      priority: 11

    - pattern: "orchestrate.*generation|coordinate.*droids|synthesize.*code"
      capabilities: ["code-orchestration", "workflow-management", "project-coordination"]
      droid_types: ["code-generation-orchestrator-droid-forge"]
      priority: 11

    - pattern: "refactor.*code|modernize.*legacy|improve.*architecture"
      capabilities: ["code-refactoring", "technical-debt", "architecture-improvement"]
      droid_types: ["refactoring-specialist-droid-forge"]
      priority: 11

    - pattern: "system.*design|architecture.*plan|technology.*stack"
      capabilities: ["system-design", "architecture-consultation", "technology-recommendations"]
      droid_types: ["architecture-consultant-droid-forge"]
      priority: 11

    - pattern: "debug.*code|analyze.*error|troubleshoot.*issue"
      capabilities: ["debugging", "code-analysis", "error-resolution"]
      droid_types: ["debugging-expert-droid-forge"]
      priority: 11

    - pattern: "pull.*request|pr.*review|merge.*conflict|review.*fix"
      capabilities: ["pr-automation", "code-review", "merge-conflict-resolution"]
      droid_types: ["auto-pr-droid-forge"]
      priority: 11

    - pattern: "incident|outage|reliability|sla|slo|monitoring|on-call"
      capabilities: ["incident-management", "system-reliability", "monitoring", "operational-excellence"]
      droid_types: ["reliability-droid-forge"]
      priority: 11

    - pattern: "cache|caching"
      capabilities: ["caching", "performance"]
      droid_types: ["implement-caching-strategy"]
      priority: 12

    - pattern: "e2e|end-to-end|s2e"
      capabilities: ["testing", "e2e"]
      droid_types: ["e2e-setup"]
      priority: 13

    - pattern: "accessibility|a11y"
      capabilities: ["accessibility", "audit"]
      droid_types: ["accessibility-audit"]
      priority: 14

    - pattern: "onboard|new.*dev|getting.*started"
      capabilities: ["onboarding", "setup"]
      droid_types: ["onboard-new-developer"]
      priority: 15

    - pattern: "unit.*test|generate.*test"
      capabilities: ["testing", "code-generation"]
      droid_types: ["generate-test-cases", "write-unit-tests"]
      priority: 16

# Git workflow configuration
git:
  # Default branch strategy
  default_branch: "main"

  # Branch naming conventions
  branch_patterns:
    feature: "feat/{task-id}-{description}"
    bugfix: "fix/{task-id}-{description}"
    refactor: "refactor/{task-id}-{description}"

  # Commit message format
  commit_format: "{type}({scope}): {description}"

  # Auto-commit settings
  auto_commit:
    enabled: true
    require_review: false

# ai-dev-tasks integration
ai_dev_tasks:
  # GitHub repository for process files
  process_repo: "factory-ai/ai-dev-tasks"
  process_ref: "main"

  # Local directory for process files
  local_dir: "ai-dev-tasks"

  # Task file format
  task_file_format: "tasks-{prd-file-name}.md"



# Performance settings
performance:
  # Maximum concurrent droid executions
  max_concurrent_droids: 3

  # Task retry attempts
  max_retries: 2

  # Retry delay in seconds
  retry_delay: 5

  # Execution tracking settings
  execution_tracking:
    # Timeout for task execution (seconds)
    default_timeout: 3600  # 1 hour

    # Cleanup interval for stale executions (seconds)
    cleanup_interval: 300  # 5 minutes

    # Performance metrics collection interval (seconds)
    metrics_interval: 600  # 10 minutes

    # Result validation enabled
    enable_result_validation: true

    # Droid self-reporting enabled
    enable_self_reporting: true

# Concurrency and file locking settings
concurrency:
  # File locking mechanism to prevent race conditions
  file_locking:
    enabled: true
    # Lock file extension
    lock_extension: ".lock"
    # Lock timeout in seconds (removes stale locks)
    lock_timeout: 300
    # Retry interval for acquiring locks (seconds)
    lock_retry_interval: 1
    # Maximum lock acquisition attempts
    max_lock_attempts: 60

  # State management
  state_management:
    # Atomic write operations (write to temp, then rename)
    atomic_writes: true
    # Backup strategy for critical files
    backup_on_write: true
    # State validation before operations
    validate_state: true

# Error handling and recovery
error_handling:
  # Human-in-the-loop triggers
  human_intervention_triggers:
    - "git_conflict"
    - "critical_file_corruption"
    - "dependency_resolution_failure"
    - "authentication_failure"

  # Automatic recovery actions
  auto_recovery:
    # Clean stale locks on startup
    clean_stale_locks: true
    # Reset failed tasks to pending state
    reset_failed_tasks: true
    # Create fallback branches for git failures
    create_fallback_branches: true

  # Notification settings
  notifications:
    # Notify on human intervention required
    notify_on_intervention: true
    # Notify on critical failures
    notify_on_critical_failure: true

# One-Shot Mode Configuration (Phase 7: Tasks 7.1-7.12)
# Note: One-shot mode is disabled by default to maintain backwards compatibility
# Users must explicitly opt-in by responding "one-shot" to the mode selection prompt
one_shot_mode:
  enabled: false
  max_parallel: 3
  max_retries: 3
  coverage_threshold: 90
